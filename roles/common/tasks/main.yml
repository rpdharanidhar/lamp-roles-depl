---
- name: Install required packages
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - apt-transport-https
    - ca-certificates
    - curl
    - gnupg-agent
    - software-properties-common
    - python3
    - python3-venv
    - python3-pip
    - gnupg
    - lsb-release
  when: item != '' 
  become: yes

- name: Update apt package cache
  apt:
    update_cache: yes
  become: yes
  ignore_errors: yes

- name: Upgrade all packages
  apt:
    upgrade: yes
    autoremove: yes
  become: yes
  ignore_errors: yes

- name: Install required packages with mysql server
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - mysql-server
    - mysql-client
    - python3-mysqldb
    - pip
    - libapache2-mod-php7.4
  when: item != '' 
  become: yes

- name: Update apt package cache
  apt:
    update_cache: yes
  become: yes
  ignore_errors: yes

- name: Upgrade all packages
  apt:
    upgrade: yes
    autoremove: yes
  become: yes
  ignore_errors: yes

# - name: Add PHP 7.4 repository
#   become: yes
#   shell: |
#     wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg &&
#     echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/php.list

- name: Install PHP and MySQL for PHP
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - php7.4
    - php7.4-mysql
  when: item != '' 
  become: yes

- name: Install unzip package
  apt:
    name: unzip
    state: present
